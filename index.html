<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document PDF Generator</title>
    <meta
      name="description"
      content="Generate professional PDF documents with QR verification in your browser."
    />
    <style>
      :root {
        color-scheme: light;
        --bg: #f3f6fb;
        --surface: #ffffff;
        --text: #0f172a;
        --muted: #475569;
        --primary: #2563eb;
        --primary-dark: #1d4ed8;
        --border: #dbe4f0;
        --success: #0f766e;
        --radius: 16px;
        --shadow: 0 20px 35px -24px rgba(15, 23, 42, 0.35);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: Inter, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        color: var(--text);
        background: radial-gradient(circle at top right, #dbeafe, transparent 50%), var(--bg);
        min-height: 100vh;
      }

      .wrapper {
        width: min(1100px, 100% - 2rem);
        margin: 2.5rem auto;
        display: grid;
        gap: 1.25rem;
      }

      .hero {
        text-align: center;
        padding: 1rem;
      }

      .hero h1 {
        margin: 0;
        font-size: clamp(1.8rem, 3vw, 2.4rem);
        letter-spacing: -0.02em;
      }

      .hero p {
        color: var(--muted);
        margin: 0.7rem auto 0;
        max-width: 700px;
      }

      .grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 1.25rem;
      }

      .card {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        padding: 1.25rem;
      }

      form {
        display: grid;
        gap: 0.95rem;
      }

      .row {
        display: grid;
        grid-template-columns: 1fr;
        gap: 0.9rem;
      }

      label {
        display: grid;
        gap: 0.4rem;
        font-size: 0.94rem;
        font-weight: 600;
      }

      input {
        width: 100%;
        border: 1px solid #cbd5e1;
        border-radius: 12px;
        padding: 0.75rem 0.85rem;
        font-size: 1rem;
        color: var(--text);
        outline: none;
        transition: border-color 0.18s, box-shadow 0.18s;
      }

      input:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.14);
      }

      .hint {
        font-size: 0.84rem;
        color: var(--muted);
      }

      .actions {
        display: flex;
        flex-wrap: wrap;
        gap: 0.7rem;
        margin-top: 0.25rem;
      }

      button,
      .download-link {
        appearance: none;
        border: 0;
        border-radius: 12px;
        padding: 0.75rem 1rem;
        font-size: 0.97rem;
        font-weight: 700;
        cursor: pointer;
        text-decoration: none;
        transition: transform 0.15s ease, background 0.2s ease, opacity 0.2s ease;
      }

      button {
        background: var(--primary);
        color: #fff;
      }

      button:hover {
        background: var(--primary-dark);
        transform: translateY(-1px);
      }

      button:disabled {
        cursor: not-allowed;
        opacity: 0.65;
        transform: none;
      }

      .download-link {
        background: #0f766e;
        color: #fff;
        pointer-events: none;
        opacity: 0.55;
      }

      .download-link.ready {
        opacity: 1;
        pointer-events: auto;
      }

      .status {
        margin: 0;
        min-height: 1.4em;
        font-size: 0.93rem;
        color: var(--muted);
      }

      .status.success {
        color: var(--success);
      }

      .status.error {
        color: #b91c1c;
      }

      .preview-frame {
        width: 100%;
        border: 1px solid var(--border);
        border-radius: 14px;
        min-height: 68vh;
        background: #f8fafc;
      }

      .meta {
        display: grid;
        gap: 0.25rem;
        font-size: 0.9rem;
        color: #334155;
      }

      code {
        background: #eff6ff;
        border: 1px solid #dbeafe;
        border-radius: 8px;
        padding: 0.1rem 0.35rem;
      }

      @media (min-width: 900px) {
        .grid {
          grid-template-columns: 390px 1fr;
          align-items: start;
        }

        .row {
          grid-template-columns: 1fr 1fr;
        }
      }
    </style>
  </head>
  <body>
    <main class="wrapper">
      <section class="hero">
        <h1>PDF Document Generator</h1>
        <p>
          Create polished A4 documents in your browser with an embedded QR verification link.
          Fill in the form, preview instantly, then download your PDF.
        </p>
      </section>

      <section class="grid">
        <article class="card">
          <form id="docForm" novalidate>
            <label>
              Full Name
              <input id="fullName" name="fullName" type="text" autocomplete="name" required />
            </label>

            <div class="row">
              <label>
                Age
                <input id="age" name="age" type="number" min="1" max="120" required />
              </label>

              <label>
                Nationality
                <input id="nationality" name="nationality" type="text" required />
              </label>
            </div>

            <label>
              Document Number (optional)
              <input id="documentNumber" name="documentNumber" type="text" maxlength="40" />
              <span class="hint">If left blank, a unique number will be generated automatically.</span>
            </label>

            <div class="actions">
              <button id="generateBtn" type="submit">Generate PDF</button>
              <a id="downloadLink" class="download-link" download="document.pdf">Download PDF</a>
            </div>

            <p id="status" class="status" aria-live="polite"></p>
          </form>

          <div class="meta">
            <span>Verification URL pattern:</span>
            <code id="verifyTemplate">https://verify.example.com/doc/...</code>
          </div>
        </article>

        <article class="card">
          <iframe id="previewFrame" class="preview-frame" title="PDF Preview"></iframe>
        </article>
      </section>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.4/build/qrcode.min.js"></script>
    <script>
      (() => {
        const { jsPDF } = window.jspdf;

        const form = document.getElementById('docForm');
        const generateBtn = document.getElementById('generateBtn');
        const statusEl = document.getElementById('status');
        const downloadLink = document.getElementById('downloadLink');
        const previewFrame = document.getElementById('previewFrame');
        const verifyTemplate = document.getElementById('verifyTemplate');

        const verificationBaseUrl = `${window.location.origin}/verify`;
        verifyTemplate.textContent = `${verificationBaseUrl}?documentNumber=...`;

        let activePdfUrl = '';

        form.addEventListener('submit', async (event) => {
          event.preventDefault();
          setStatus('Generating PDF...', '');

          const formData = new FormData(form);
          const fullName = String(formData.get('fullName') || '').trim();
          const age = String(formData.get('age') || '').trim();
          const nationality = String(formData.get('nationality') || '').trim();
          let documentNumber = String(formData.get('documentNumber') || '').trim();

          const validationError = validateInput({ fullName, age, nationality, documentNumber });
          if (validationError) {
            setStatus(validationError, 'error');
            return;
          }

          if (!documentNumber) {
            documentNumber = generateDocumentNumber();
            form.documentNumber.value = documentNumber;
          }

          generateBtn.disabled = true;
          downloadLink.classList.remove('ready');

          try {
            const verificationUrl = `${verificationBaseUrl}?documentNumber=${encodeURIComponent(
              documentNumber
            )}`;

            const pdfBlob = await buildPdf({
              fullName,
              age,
              nationality,
              documentNumber,
              verificationUrl
            });

            updatePdfPreview(pdfBlob, documentNumber);
            setStatus('PDF ready. You can preview and download now.', 'success');
          } catch (error) {
            console.error(error);
            setStatus('Failed to generate PDF. Please try again.', 'error');
          } finally {
            generateBtn.disabled = false;
          }
        });

        function validateInput({ fullName, age, nationality, documentNumber }) {
          if (!fullName) {
            return 'Full Name is required.';
          }

          if (!age) {
            return 'Age is required.';
          }

          const parsedAge = Number(age);
          if (!Number.isFinite(parsedAge) || parsedAge < 1 || parsedAge > 120) {
            return 'Age must be a valid number between 1 and 120.';
          }

          if (!nationality) {
            return 'Nationality is required.';
          }

          if (documentNumber && !/^[A-Za-z0-9\-_/]{4,40}$/.test(documentNumber)) {
            return 'Document Number may contain letters, numbers, -, _, / and be 4-40 chars long.';
          }

          return '';
        }

        function generateDocumentNumber() {
          const now = new Date();
          const datePart = `${now.getFullYear()}${String(now.getMonth() + 1).padStart(2, '0')}${String(
            now.getDate()
          ).padStart(2, '0')}`;
          const randomPart = Math.random().toString(36).slice(2, 8).toUpperCase();
          return `DOC-${datePart}-${randomPart}`;
        }

        async function buildPdf({ fullName, age, nationality, documentNumber, verificationUrl }) {
          const doc = new jsPDF({ orientation: 'portrait', unit: 'mm', format: 'a4' });
          const pageWidth = 210;
          const margin = 20;

          doc.setFillColor(15, 23, 42);
          doc.rect(0, 0, pageWidth, 33, 'F');

          doc.setTextColor(255, 255, 255);
          doc.setFont('helvetica', 'bold');
          doc.setFontSize(18);
          doc.text('Professional Document Certificate', margin, 16);
          doc.setFontSize(10);
          doc.setFont('helvetica', 'normal');
          doc.text('Generated digitally with verification QR code', margin, 24);

          doc.setTextColor(15, 23, 42);
          doc.setFont('helvetica', 'bold');
          doc.setFontSize(12);
          doc.text('Document Information', margin, 48);

          doc.setDrawColor(203, 213, 225);
          doc.roundedRect(margin, 54, 170, 92, 3, 3);

          const rows = [
            ['Full Name', fullName],
            ['Age', String(age)],
            ['Nationality', nationality],
            ['Document Number', documentNumber],
            ['Issue Date', new Date().toLocaleDateString()]
          ];

          let y = 67;
          rows.forEach(([label, value]) => {
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(11);
            doc.text(`${label}:`, margin + 8, y);
            doc.setFont('helvetica', 'normal');
            doc.text(value, margin + 54, y);
            y += 15;
          });

          doc.setFont('helvetica', 'normal');
          doc.setTextColor(71, 85, 105);
          doc.setFontSize(10);
          doc.text('Scan the QR code to verify this document online.', margin, 169);

          const qrDataUrl = await QRCode.toDataURL(verificationUrl, {
            errorCorrectionLevel: 'M',
            margin: 1,
            width: 300,
            color: {
              dark: '#0f172a',
              light: '#ffffff'
            }
          });

          doc.addImage(qrDataUrl, 'PNG', 150, 158, 40, 40, undefined, 'FAST');

          doc.setFontSize(9);
          doc.setTextColor(100, 116, 139);
          const verificationText = `Verification URL: ${verificationUrl}`;
          const wrapped = doc.splitTextToSize(verificationText, 166);
          doc.text(wrapped, margin, 214);

          doc.setDrawColor(226, 232, 240);
          doc.line(margin, 248, 190, 248);
          doc.setTextColor(71, 85, 105);
          doc.text('Authorized by Digital Document Service', margin, 255);
          doc.text(`Ref: ${documentNumber}`, 190, 255, { align: 'right' });

          return doc.output('blob');
        }

        function updatePdfPreview(pdfBlob, documentNumber) {
          if (activePdfUrl) {
            URL.revokeObjectURL(activePdfUrl);
          }

          activePdfUrl = URL.createObjectURL(pdfBlob);
          previewFrame.src = activePdfUrl;

          downloadLink.href = activePdfUrl;
          downloadLink.download = `${documentNumber}.pdf`;
          downloadLink.classList.add('ready');
        }

        function setStatus(message, type) {
          statusEl.textContent = message;
          statusEl.classList.remove('error', 'success');
          if (type) {
            statusEl.classList.add(type);
          }
        }

        window.addEventListener('beforeunload', () => {
          if (activePdfUrl) {
            URL.revokeObjectURL(activePdfUrl);
          }
        });
      })();
    </script>
  </body>
</html>
